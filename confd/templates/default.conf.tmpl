{{range $dir := lsdir "/"}}
server {
    {{ $url := split (base $dir) ":" }}
    listen       {{index $url 1}};
    server_name  {{index $url 0}};
    {{$custdir := printf "/%s/*" $dir}}
    {{range gets $custdir}}
    {{base .Key}} {{.Value}};
    {{end}}
    
    {{$custdir := printf "/%s" $dir}}
    {{range $locationdir := lsdir $custdir}}
    {{$locationdir :=  printf "/%s/%s/location" $dir $locationdir}}
    location  {{getv $locationdir}} {
        {{$rundir := dir $locationdir}}
        {{$propertiesdir := printf "%s/properties/*" $rundir }}
        {{range gets $propertiesdir}} 
        {{base .Key}} {{.Value}};
        {{end}}
     
        {{$proxy_set_headerdir :=printf "%s/proxy_set_header/*" $rundir }}
        {{range gets $proxy_set_headerdir}}
        proxy_set_header {{base .Key}} {{.Value}};
        {{end}}
    }
    {{end}}
}
{{end}}
